#!/usr/bin/env bash

set -e -E -u -o pipefail -o noclobber -o noglob +o braceexpand || exit 1
trap 'printf "[ee] failed: %s\n" "${BASH_COMMAND}" >&2' ERR || exit 1

#PATH=$HOME/bin:$PATH


MOS_NODE_PUBLIC_IP=$(/sbin/ifconfig eth0 | grep 'inet addr:' | cut -d: -f2 | awk '{print $1}')

#
# MYSQL
#
export MODACLOUDS_MYSQL_ENDPOINT_IP=127.0.0.1
export MODACLOUDS_MYSQL_ENDPOINT_PORT=3306

#
# RABBITMQ
#
export MODACLOUDS_RABBITMQ_ENDPOINT_IP=127.0.0.1
export MODACLOUDS_RABBITMQ_ENDPOINT_PORT=21688

#
# FUSEKI
#
export MODACLOUDS_FUSEKI_ENDPOINT_IP=127.0.0.1
export MODACLOUDS_FUSEKI_ENDPOINT_PORT=3030

#
# OBJECT STORE
#
export MOSAIC_OBJECT_STORE_ENDPOINT_IP=127.0.0.1
export MOSAIC_OBJECT_STORE_ENDPOINT_PORT=20622

#
# TOWER4CLOUDS
#
export MODACLOUDS_TOWER4CLOUDS_DATA_ANALYZER_PUBLIC_ENDPOINT_IP=${MOS_NODE_PUBLIC_IP}
export MODACLOUDS_TOWER4CLOUDS_DATA_ANALYZER_PUBLIC_ENDPOINT_PORT=8175

export MODACLOUDS_TOWER4CLOUDS_MANAGER_PUBLIC_ENDPOINT_IP=${MOS_NODE_PUBLIC_IP}
export MODACLOUDS_TOWER4CLOUDS_MANAGER_PUBLIC_ENDPOINT_PORT=8170

export MODACLOUDS_TOWER4CLOUDS_RDF_HISTORY_DB_ENDPOINT_IP=127.0.0.1
export MODACLOUDS_TOWER4CLOUDS_RDF_HISTORY_DB_ENDPOINT_PORT=9100

#
# LOAD BALANCER CONTROLLER
#
export MODACLOUDS_LOAD_BALANCER_CONTROLLER_ENDPOINT_IP=127.0.0.1
export MODACLOUDS_LOAD_BALANCER_CONTROLLER_ENDPOINT_PORT=8088

#
# LOAD BALANCER REASONER
#

#
# MODELS@RUNTIME
#
export MODACLOUDS_MODELS_AT_RUNTIME_ENDPOINT_IP=127.0.0.1
export MODACLOUDS_MODELS_AT_RUNTIME_ENDPOINT_PORT=9000

#
# SLA
#
export MODACLOUDS_SLACORE_ENDPOINT_IP=127.0.0.1
export MODACLOUDS_SLACORE_ENDPOINT_PORT=9040
export MODACLOUDS_SLACORE_PUBLIC_ENDPOINT_IP=${MOS_NODE_PUBLIC_IP}
export MODACLOUDS_SLACORE_PUBLIC_ENDPOINT_PORT=9040

env \
    MODACLOUDS_RABBITMQ_ENDPOINT_IP=0.0.0.0 \
    start-service.sh mosaic-components-rabbitmq rabbitmq 0.7.0.11

env \
    MODACLOUDS_FUSEKI_ENDPOINT_IP=0.0.0.0 \
    start-service.sh modaclouds-services-fuseki fuseki

env \
    MODACLOUDS_OBJECT_STORE_ENDPOINT_IP=0.0.0.0 \
    start-service.sh mosaic-object-store object-store

env \
    start-service.sh modaclouds-services-tower4clouds-data-analyzer t4c-dda 0.7.0.13

env \
    start-service.sh modaclouds-services-tower4clouds-manager t4c-manager 0.7.0.13

env \
    MODACLOUDS_TOWER4CLOUDS_RDF_HISTORY_DB_ENDPOINT_IP=0.0.0.0 \
    start-service.sh modaclouds-services-tower4clouds-rdf-history-db t4c-db 0.7.0.13

env \
    MODACLOUDS_LOAD_BALANCER_CONTROLLER_ENDPOINT_IP=0.0.0.0 \
    start-service.sh modaclouds-services-load-balancer-controller lb-controller

env \
    MODACLOUDS_MODELS_AT_RUNTIME_ENDPOINT_IP=0.0.0.0 \
    MODACLOUDS_MONITORING_MANAGER_ENDPOINT_IP=$MODACLOUDS_TOWER4CLOUDS_MANAGER_PUBLIC_ENDPOINT_IP \
    MODACLOUDS_MONITORING_MANAGER_ENDPOINT_PORT=$MODACLOUDS_TOWER4CLOUDS_MANAGER_PUBLIC_ENDPOINT_PORT \
    start-service.sh modaclouds-services-models-at-runtime mrt

env \
    MODACLOUDS_SLACORE_ENDPOINT_IP=0.0.0.0 \
    start-service.sh modaclouds-services-sla-core sla
